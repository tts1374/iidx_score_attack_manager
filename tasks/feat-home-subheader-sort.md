# feat-home-subheader-sort

## 目的

- Home（スコアタ一覧）で表示件数と並び替えを常時可視化し、一覧制御の即時性を高める。
- ソート導線をフィルタボトムシートから分離し、責務を明確化する。
- スクロール時もサブヘッダー（件数 + ソート）を常時可視にし、制御レイヤーを維持する。

## 非目的

- ソートアルゴリズム自体の追加・変更。
- Web Locks / Service Worker / import/export / DB スキーマへの変更。
- Home 以外の画面構造変更。
- 検索行やフィルタチップ列の sticky 化。

## 変更点

- Home のフィルタチップ列直下にサブヘッダー行を追加する。
- サブヘッダー左側に「表示件数」、右側に「現在ソート」を常時表示する。
- サブヘッダー右側タップでソート選択 UI を開き、選択後に即時反映する。
- フィルタボトムシートからソートセクションを削除する。
- 「すべて解除」はフィルタのみ解除し、ソートは維持する。
- ソートキーと表示ラベルの対応を 1 箇所に集約し、「デフォルト」表記を出さない。
- サブヘッダーのみ sticky 化し、スクロール中も画面上部で固定表示する。
- sticky 時の背景・境界線・z-index を設定し、カードとの視覚分離を明確にする。
- モバイルで1行維持できるように、ソートラベルの省略表示（ellipsis）を追加する。
- サブヘッダー右側のソート操作を「右側エリア全体クリック」に拡張する。
- ソート操作エリアに最小タップ領域（44x44pt/48x48dp相当）を確保する。
- ソート操作エリアに hover / active / focus-visible の視覚フィードバックを追加する。
- ソート操作エリアにアクセシビリティ用の `aria-label` を追加する。
- ソートメニューをトリガー右端基準（右下→右上）で開くようにする。
- 画面端ではライブラリの自動リポジションを維持し、切れを回避する。

## 影響範囲

- ユーザー影響:
  - Home 画面で件数とソートが常時可視になる。
  - ソート変更導線がボトムシート外（サブヘッダー）に移る。
  - 「すべて解除」実行後もソートが保持される。
  - スクロール時もサブヘッダーが視認でき、一覧制御の状態確認が継続できる。
  - 右側ソート領域のタップしやすさと押下可能性の認知が改善される。
  - ソートメニューがトリガー位置と視覚的に整合し、開く位置の予測可能性が上がる。
- データ影響:
  - 既存の `home.sort` 保存を継続し、保存形式変更なし。
- 互換性:
  - 既存フィルタ条件・検索条件・一覧カード遷移を維持。
  - 既存ソートキーを継続利用し、設定互換性を維持。

## 実装方針（対象ファイル単位）

- `packages/web-app/src/App.tsx`
  - Home のソート定義・ラベル解決を集約。
  - サブヘッダー行（件数 + ソート表示/選択）を追加。
  - フィルタボトムシートのソートセクションを削除。
  - clear-all と reset の振る舞いを「フィルタのみ解除」に合わせる。
  - サブヘッダーのソートラベルに省略表示用クラスを付与する。
  - ソートボタンに `aria-label` を追加し、右側エリア全体をクリック対象にする。
  - ソート `Menu` の `anchorOrigin` / `transformOrigin` を右揃えに設定する。
- `packages/web-app/src/styles.css`
  - サブヘッダー行の最小スタイルを追加（既存レイアウトを維持）。
  - サブヘッダーのみ sticky 化（`position: sticky` / `top` / `z-index`）する。
  - 背景・divider・1行維持・ellipsis を追加する。
  - ソートボタンの最小タップ領域・hover/active/focus-visible を追加する。
- `packages/web-app/src/i18n/locales/ja.json`
  - Home サブヘッダー表示用の文言キーを追加し、ソートの既定ラベルを具体化。
  - ソート変更ボタンの aria 用文言を追加する。
- `packages/web-app/src/i18n/locales/en.json`
  - ja と同等の文言キーを追加。
- `packages/web-app/src/i18n/locales/ko.json`
  - ja と同等の文言キーを追加。

## テスト観点

- Home で件数が常時表示される（0件含む）。
- Home でソートラベルが常時表示される（「デフォルト」非表示）。
- サブヘッダーからソート変更すると一覧順と表示ラベルが即時更新される。
- フィルタボトムシート内にソート UI が残っていない。
- 「すべて解除」で検索/カテゴリ/属性は解除され、ソートは維持される。
- 既存のカード遷移（詳細遷移）と検索/フィルタ適用が破綻しない。
- 一覧スクロール時にサブヘッダーのみ sticky で固定される（チップ列は流れる）。
- sticky サブヘッダーとカードの境界が背景/線で判別できる。
- モバイル幅でサブヘッダーが1行維持され、ソートラベルが省略表示される。
- ソートの右側エリア全体がクリック可能で、最小タップ領域を満たす。
- ソートエリアで hover/active/focus-visible が視認できる。
- ソートエリアの `aria-label` が設定されている。
- ソートメニューがトリガー右端を基準に表示される。
- 画面端ではメニューが切れずに自然にリポジションされる。

## ロールバック方針

- 本変更コミットをリバートし、`App.tsx` の旧ソート導線（ボトムシート内）へ戻す。
- i18n 追加キーと CSS 追加クラスを同時に巻き戻す。

## Commit Plan（コミット分割計画）

1. Home 制御レイヤー更新（ソート責務整理、clear-all 仕様変更）
2. Home UI 更新（サブヘッダー追加、ボトムシートのソート削除、スタイル追加）
3. i18n 文言更新（ja/en/ko）
4. sticky 追補（サブヘッダー固定化、視覚分離、モバイル省略表示）
5. タップ領域追補（右側エリア全体クリック化、フィードバック、aria）
6. メニューアンカー追補（右揃え表示、端での自然なリポジション維持）
7. テスト/回帰調整（必要最小限）
