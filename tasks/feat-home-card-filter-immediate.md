# feat-home-card-filter-immediate

## 目的

- Home 一覧カードの情報強調を整理し、強いバッジを「期限」と「未共有」に集中させる。
- Home フィルタを即時反映に変更し、適用ボタン依存の操作混乱をなくす。
- フィルタモーダル下部固定アクションを廃止し、結果数とリセットを上部へ集約する。

## 非目的

- Home カード全体レイアウトの再設計（余白、タイポグラフィ、カード構造の全面変更）。
- 3 分割進捗バーの算出ロジック変更。
- Web Locks / Service Worker / import-export / DB / CI/CD への変更。
- 無関係なファイル整形、import 並べ替え、依存更新。

## 変更点

- 開催状態（開催中/開催前/終了）の表示をバッジから弱いテキストラベルへ変更する。
- 一覧カードの進捗状態バッジは「未共有」の場合のみ表示し、「未登録」「共有済」は非表示にする。
- `未共有 n` テキストは維持し、`n=0` 時は既存どおり弱表示（`progressLine-muted`）とする。
- フィルタモーダルの `homeFilterDraft` + 適用フローを廃止し、操作時に `homeQuery` を直接更新する。
- フィルタモーダルの下部固定アクション（適用/リセット/すべて解除）を削除する。
- フィルタモーダル上部に `現在の結果: {count}` と `リセット`（テキストリンク）を配置する。
- リセットはフィルタ条件を初期化し、結果数を即時更新する。

## 影響範囲（ユーザー / データ / 互換性）

- ユーザー:
  - 一覧カードで強調される情報が整理され、視線が期限と未共有に集中する。
  - フィルタ変更が即時反映され、モーダルを閉じても反映済み状態が維持される。
- データ:
  - 永続化キー（`home.state` / `home.searchText` / `home.filter.category` / `home.filter.attrs` / `home.sort`）の形式変更なし。
- 互換性:
  - 既存の絞り込み条件定義、並び替え仕様、3 分割バー仕様を維持する。

## 実装方針（対象ファイル単位）

- `packages/web-app/src/pages/HomePage.tsx`
  - 開催状態表示を弱ラベル用クラスへ変更する。
  - 進捗状態バッジの表示条件を `sendWaitingCount > 0` のみに変更する。
- `packages/web-app/src/App.tsx`
  - `homeFilterDraft` 依存を除去し、フィルタ UI 操作を `homeQuery` 直接更新に切り替える。
  - `適用` ボタンと下部アクション領域を削除する。
  - モーダル上部に `result_count` と `reset` を配置する。
- `packages/web-app/src/styles.css`
  - 開催状態ラベル用の弱い見た目クラスを追加する。
  - 不要になったフィルタ下部アクション領域スタイルを削除し、上部行レイアウトを追加する。
  - 進捗バッジが未共有時のみ表示される実装に合わせてクラスを整理する。
- `packages/web-app/src/pages/HomePage.test.tsx`
  - 開催状態ラベル化、未共有バッジ条件表示に合わせてテスト期待値を更新する。

## テスト観点

- 一覧カードで強いバッジが「期限」「未共有（該当時のみ）」に限定される。
- 開催状態がバッジではなく弱ラベルで表示される。
- `sendWaitingCount=0` のカードで進捗状態バッジが表示されない。
- フィルタモーダルで状態/カテゴリ/種別/属性の変更が即時に一覧へ反映される。
- モーダル外タップで閉じても、直前に変更したフィルタが維持される。
- モーダル下部固定アクションが存在しない。
- モーダル上部に `result_count` と `reset` があり、`reset` で条件が初期化される。

## ロールバック方針

- 本変更コミットをリバートして、カード表示・フィルタ反映ロジックを旧仕様へ戻す。
- 上部結果数行追加と下部アクション削除のスタイル差分を同時に巻き戻す。
- テスト更新を巻き戻し、旧 UI 仕様の期待値に戻す。

## Commit Plan（コミット分割計画）

1. 本タスク差分を 1 論理コミットで実施
2. 変更内容:
   - Plan 文書追加（本 tasks ファイル作成）
   - 一覧カード表示調整（開催状態ラベル化 + 未共有バッジ条件表示）
   - フィルタモーダル即時反映化（適用廃止 + 上部結果数/リセット + 下部固定アクション削除）
   - テスト更新
3. 検証（lint/test/build）はコミット前に完了済み
